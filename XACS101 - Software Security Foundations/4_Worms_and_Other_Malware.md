# Worms and Other Malware

---

# 5.1 What is a Worm?
- many malware instances started as worms

*Virus*: program that copies itself into other programs
- used to spread in the 80s mostly through copying itself from one disk to another
- ex. virus onto USB stick and put in parking lots and entice users to put it in their machine
- rate of spread typically dependant on how often a user does some action

*Worm*: a virus, but that doesn't use a traditional mechanism for replication (disk to PC or disk to disk). 
- uses the _network_ to distribute itself
- becuase no required human involvement, worms can spread _much_ faster than viruses

# 5.2 An Abridged History of Worms

## Morris Worm (1988)

### 5.2.1 What It Did 
- first worm _ever_ to spread on the internet
- graduate student at Cornell (Robert Morris)
- he had constructed a program that was capable of using the network to copy itself
- it didn't touch any data or steal anything, it just copied itself
- written it really as an experiment that he set loose
- infected 6k computers in _just a few hours_
- in 1988, there wasn't much of an internet - therefore, 6k computers was a significant fraction
- exploited **buffer overflow** in `fingerd` in Unix
  - `fingerd` allows you to check who's logged in
  - server-side component called `finger daemon
  - took advantage of the buffer overflow and the fact that computers used `Sendmail` to transfer mail from one UNIX machine to another
  - `Sendmail` had a debug mode that would allow for execution of arbitrary commands on a host
  - Obviously if you're in prod, you shouldn't be able to run something in debug mode
  - Packaged within it was a dictionary of 432 often-used passwords; would login with those and execute commands using these passwords

### 5.2.2 What We Learned
- diversity is good for software
  - back then, most machines had similar software images running and this could be exploited
  - but, with many different OSes and programs, etc. it makes it harder for worms to spread
  - but, this was kind of ignored; look at Windows
- large programs are more vulnerable to attack
  - complexity is the enemey of security, remember
  - `Sendmail` was big. Had a number of bugs
  - `fingerd` program was small, but still buggy
- limiting features limits holes 
  - `Sendmail` was running with its debug mode _enabled_
  - if it was turned off, wouldn't have been able to spread
- users should choose good passwords
  - if users chose good passwords that weren't simple dictionary words (or one of those 432), its spread would have also been harder


### 5.2.3 Creation of CERT
- created in response to the Morris worm

**Computer Emergency Response Team (CERT) **
- leading centre on worm activity

### 5.2.4 The Code Red Worm
- about a decade after the Morris worm - early 2000s
- exploited the `indexing server` feature on Microsoft Windows
- enabled by default and automatically started a web server with OS
- the web server had a buffer overflow vulnerability
- randomly scanned IP addresses and if it found an IIS server (Internet Information Server), it would try to spread to that 
- infected 2000 hosts/min; affected 10s of thousands of hosts
- when it would infect a web server it would only keep itself in memory and most virus scanners at that time would work by scanning disk; Code Red didn't touch the disk
- but since only in memory, when you shut machine off and reboot it would be uninfected (until reinfected)
- would deface home of web server basically to get notoriety

### 5.2.5 The Nimda Worm

- similar to Code Red, but would use multiple propagation vectors

**Propagation vector**: method by which a worm spreads to another machine
**Payload**: data worm carries while travelling 

- Propagation vectors:
  - when a server was infected, if a client went to the web server, the browser would download a file and infect the client as well 
  - also spread server to server (like Code Red)
  - would take advantage of client's email and send emails with the worm code

### 5.2.6 SQL Slammer Worm (2003)
- attacked Microsoft SQL Server
- disabled the server, scanned other random IPs
- similar to Code Red and Nimda in some ways
- started to have an effect on financial systems
- knocked out ~13k Bank of America ATMs: kind of like a denial of service against ATMs
- one of the first worms where the White House was briefed about the attacked
- airline networks also affected (cancelled & delayed)

# 5.3 Types of Malware 

**Rootkit**: imposter OS tools
  - mimics the operating system; runs in a way that's undetectable by the user.
  - runs certain parts of the OS that -- if you query to see whether its infected -- will respond in a way to make it seem like it's not there
  - ex. Unix: `ls`, `ps` replaced so if you try to look for the Rootkit, you're probably running the malware version of the commands

**Botnets**: network of compromised machines
  - once a machine is infected, it can connect to a central server or P2P network to figure out what to do next
  - malware that has command and control that an attacker can use to command a whole network of compromised machines
  - ex. DoS attacks against Amazon and Yahoo in 2001

**Spyware**: once installed, will monitor a user's activity
  - malware that's spyware can wait for you to type in a credit card number and then pass that as the payload
  - intelligence orgs can also take use of spyware - obviously

**Keyloggers**: monitors all key presses, mouse movements, screenshots
  - used to steal private credentials (CC numbers, usernames, passwords, etc.)

**Trojan Horse**: claims to do something but really does something else
  - ex. Claims to be a game, but really steals your CC number as a keylogger

**Adware**: shows ads to useres without their consent
 
**Clickbot**: bot clicks on ads
  - attackers sign up as affiliates for various publishers/ad networks and get a cut of revenue whenever a bot clicks on

## Clickbot A Botnet^2
- wanted to monetize Google and a couple of other ad networks
- first clickbot that received wide distribution (attacker probably paid to have it distributed)
- used a command & control server that used `http` as its method for communicating with clients
- prior, most would use IRC (Internet Relay Chat) to communicate between client & command and control server
- because `http` allowed beyond firewalls, would allow for control of additional clients
- more commands in `http`
- wouldn't directly click on ads; the attackers signed up as sub-syndicators and would click on syndicated search engines
- only 7/24 virus scanners had found it
- interesting client-side architecture: often, you want the clicks to look as legit as possible so if you directly issue network requests it doesn't seem authentic
  - this was implemented as a helper object to IE
  - would script IE and have IE do its clicks with a very low frequency
- had a database table with all IP addresses of compromised machines and how many clicks per IP
  - made sure no IP clicked too much
  - would make sure it asked server before clicking on an ad

## Fake Anti-Virus Trojan Horse
- spread of malicious software claiming to be anti-virus software
- webpage tells user they're infected with some sort of virus and they can download the software to deal with that

## DroidDream: Mobile Trojan Horse
- hit **March 2011**
- downloaded 50 or so of most popular application from Google Play store
- injected malware and re-uploaded into the market
- within just a couple of hours, ~250k people had downloaded one of the applications: **Bowlign Time**
  - allows you to basically bowl virtually
  - in the background attempts to take root access on the phone through an exploit called **Rage Against the Cage**
    - starts up a whole bunch of processes 
    - last process gets to run as root user because a check in the OS gets messed up
    - connects to a botmaster IP where a server was running and attacker could command 250k devices
- called DroidDream because it wouldn't run during the day; only at night

## Distributing Malware
*"The Ghost in the Browser: Analysis of Web-based Malware"*
- disbriuting malware by worms is very observable
- but not the way to go if you don't want to be detected; was mostly used by fame-seekers
- Initially, the two most popular forms of malware distribution were very observable:
  - worm distribution
  - email distribution
- 2004: less observable, more efficient distribution mechanisms investigated
  - **drive-by download**
    - server that's infected can result in a download going to a user and then infect a client as a result 
    - similar to what Nimba did
    - attackers would infect servers in a variety of ways:
      - they'd infect lots of legit website 
        - ex. NASDAQ, London Stock Exchange
    - when a user goes to the server or website, just by loading the page they get infected using a combo of browser and plug-in vulnerabilities
  - search engine and browser community have been very aggressive with trying to prevent this

## Zeus Botnet
- impacted financial community
- focused on stealing financial credentials
- would spread by drive-by-download and phishing in 2009; first identified in 2007
- part of the reason it affected so many machines was because of drive-by-downloading

## How a Drive-By-Download Attack Works

1. Inject legit web page with malicious code or direct user to already infected web page.
2. Once user is at the infected web page, it basically has JS/IFRAME code whose sole goal is to fingerprint user's browser and figure out version, and plugins. Attackers have online db of exploits against every major plug-in, browser and OS
2004: less observable, more efficient distribution mechanisms investigated
  - **drive-by download**
    - server that's infected can result in a download going to a user and then infect a client as a result 
    - similar to what Nimba did
    - attackers would infect servers in a variety of ways:
      - they'd infect lots of legit website 
        - ex. NASDAQ, London Stock Exchange
    - when a user goes to the server or website, just by loading the page they get infected using a combo of browser and plug-in vulnerabilities
  - search engine and browser community have been very aggressive with trying to prevent this

## Zeus Botnet
- impacted financial community
- focused on stealing financial credentials
- would spread by drive-by-download and phishing in 2009; first identified in 2007
- part of the reason it affected so many machines was because of drive-by-downloading

## How a Drive-By-Download Attack Works

1. Inject legit web page with malicious code or direct user to already infected web page.
2. Once user is at the infected web page, it basically has JS/IFRAME code whose sole goal is to fingerprint user's browser and figure out version, and plugins. Attackers have online db of exploits against every major plug-in, browser and OS
2004: less observable, more efficient distribution mechanisms investigated
  - **drive-by download**
    - server that's infected can result in a download going to a user and then infect a client as a result 
    - similar to what Nimba did
    - attackers would infect servers in a variety of ways:
      - they'd infect lots of legit website 
        - ex. NASDAQ, London Stock Exchange
    - when a user goes to the server or website, just by loading the page they get infected using a combo of browser and plug-in vulnerabilities
  - search engine and browser community have been very aggressive with trying to prevent this

## Zeus Botnet
- impacted financial community
- focused on stealing financial credentials
- would spread by drive-by-download and phishing in 2009; first identified in 2007
- part of the reason it affected so many machines was because of drive-by-downloading

## How a Drive-By-Download Attack Works

1. Inject legit web page with malicious code or direct user to already infected web page.
2. Once user is at the infected web page, it basically has JS/IFRAME code whose sole goal is to fingerprint user's browser and figure out version, and plugins. Attackers have online db of exploits against every major plug-in, browser and OS
2004: less observable, more efficient distribution mechanisms investigated
  - **drive-by download**
    - server that's infected can result in a download going to a user and then infect a client as a result 
    - similar to what Nimba did
    - attackers would infect servers in a variety of ways:
      - they'd infect lots of legit website 
        - ex. NASDAQ, London Stock Exchange
    - when a user goes to the server or website, just by loading the page they get infected using a combo of browser and plug-in vulnerabilities
  - search engine and browser community have been very aggressive with trying to prevent this

## Zeus Botnet
- impacted financial community
- focused on stealing financial credentials
- would spread by drive-by-download and phishing in 2009; first identified in 2007
- part of the reason it affected so many machines was because of drive-by-downloading

## How a Drive-By-Download Attack Works

1. Inject legit web page with malicious code or direct user to already infected web page.
2. Once user is at the infected web page, it basically has JS/IFRAME code whose sole goal is to fingerprint user's browser and figure out version, and plugins. Attackers have online db of exploits against every major plug-in, browser and OS
2004: less observable, more efficient distribution mechanisms investigated
  - **drive-by download**
    - server that's infected can result in a download going to a user and then infect a client as a result 
    - similar to what Nimba did
    - attackers would infect servers in a variety of ways:
      - they'd infect lots of legit website 
        - ex. NASDAQ, London Stock Exchange
    - when a user goes to the server or website, just by loading the page they get infected using a combo of browser and plug-in vulnerabilities
  - search engine and browser community have been very aggressive with trying to prevent this

## Zeus Botnet
- impacted financial community
- focused on stealing financial credentials
- would spread by drive-by-download and phishing in 2009; first identified in 2007
- part of the reason it affected so many machines was because of drive-by-downloading

## How a Drive-By-Download Attack Works

1. Inject legit web page with malicious code or direct user to already infected web page.
2. Once user is at the infected web page, it basically has JS/IFRAME code whose sole goal is to fingerprint user's browser and figure out version, and plugins. Attackers have online db of exploits against every major plug-in, browser and OS
2004: less observable, more efficient distribution mechanisms investigated
  - **drive-by download**
    - server that's infected can result in a download going to a user and then infect a client as a result 
    - similar to what Nimba did
    - attackers would infect servers in a variety of ways:
      - they'd infect lots of legit website 
        - ex. NASDAQ, London Stock Exchange
    - when a user goes to the server or website, just by loading the page they get infected using a combo of browser and plug-in vulnerabilities
  - search engine and browser community have been very aggressive with trying to prevent this

## Zeus Botnet
- impacted financial community
- focused on stealing financial credentials
- would spread by drive-by-download and phishing in 2009; first identified in 2007
- part of the reason it affected so many machines was because of drive-by-downloading

## How a Drive-By-Download Attack Works

1. Inject legit web page with malicious code or direct user to already infected web page.
2. Once user is at the infected web page, it basically has JS/IFRAME code whose sole goal is to fingerprint user's browser and figure out version, and plugins. Attackers have online db of exploits against every major plug-in, browser and OS
2004: less observable, more efficient distribution mechanisms investigated
  - **drive-by download**
    - server that's infected can result in a download going to a user and then infect a client as a result 
    - similar to what Nimba did
    - attackers would infect servers in a variety of ways:
      - they'd infect lots of legit website 
        - ex. NASDAQ, London Stock Exchange
    - when a user goes to the server or website, just by loading the page they get infected using a combo of browser and plug-in vulnerabilities
  - search engine and browser community have been very aggressive with trying to prevent this

## Zeus Botnet
- impacted financial community
- focused on stealing financial credentials
- would spread by drive-by-download and phishing in 2009; first identified in 2007
- part of the reason it affected so many machines was because of drive-by-downloading

## How a Drive-By-Download Attack Works

1. Inject legit web page with malicious code or direct user to already infected web page.
2. Once user is at the infected web page, it basically has JS/IFRAME code whose sole goal is to fingerprint user's browser and figure out version, and plugins. Attackers have online db of exploits against every major plug-in, browser and OS
2004: less observable, more efficient distribution mechanisms investigated
  - **drive-by download**
    - server that's infected can result in a download going to a user and then infect a client as a result 
    - similar to what Nimba did
    - attackers would infect servers in a variety of ways:
      - they'd infect lots of legit website 
        - ex. NASDAQ, London Stock Exchange
    - when a user goes to the server or website, just by loading the page they get infected using a combo of browser and plug-in vulnerabilities
  - search engine and browser community have been very aggressive with trying to prevent this

## Zeus Botnet
- impacted financial community
- focused on stealing financial credentials
- would spread by drive-by-download and phishing in 2009; first identified in 2007
- part of the reason it affected so many machines was because of drive-by-downloading

## How a Drive-By-Download Attack Works

1. Inject legit web page with malicious code or direct user to already infected web page.
2. Once user is at the infected web page, it basically has JS/IFRAME code whose sole goal is to fingerprint user's browser and figure out version, and plugins. Attackers have online db of exploits against every major plug-in, browser and OS
2004: less observable, more efficient distribution mechanisms investigated
  - **drive-by download**
    - server that's infected can result in a download going to a user and then infect a client as a result 
    - similar to what Nimba did
    - attackers would infect servers in a variety of ways:
      - they'd infect lots of legit website 
        - ex. NASDAQ, London Stock Exchange
    - when a user goes to the server or website, just by loading the page they get infected using a combo of browser and plug-in vulnerabilities
  - search engine and browser community have been very aggressive with trying to prevent this

## Zeus Botnet
- impacted financial community
- focused on stealing financial credentials
- would spread by drive-by-download and phishing in 2009; first identified in 2007
- part of the reason it affected so many machines was because of drive-by-downloading

## How a Drive-By-Download Attack Works

1. Inject legit web page with malicious code or direct user to already infected web page.
2. Once user is at the infected web page, it basically has JS/IFRAME code whose sole goal is to fingerprint user's browser and figure out version, and plugins. Attackers have online db of exploits against every major plug-in, browser and OS
2004: less observable, more efficient distribution mechanisms investigated
  - **drive-by download**
    - server that's infected can result in a download going to a user and then infect a client as a result 
    - similar to what Nimba did
    - attackers would infect servers in a variety of ways:
      - they'd infect lots of legit website 
        - ex. NASDAQ, London Stock Exchange
    - when a user goes to the server or website, just by loading the page they get infected using a combo of browser and plug-in vulnerabilities
  - search engine and browser community have been very aggressive with trying to prevent this

## Zeus Botnet
- impacted financial community
- focused on stealing financial credentials
- would spread by drive-by-download and phishing in 2009; first identified in 2007
- part of the reason it affected so many machines was because of drive-by-downloading

## How a Drive-By-Download Attack Works

1. Inject legit web page with malicious code or direct user to already infected web page.
2. Once user is at the infected web page, it basically has JS/IFRAME code whose sole goal is to fingerprint user's browser and figure out version, and plugins. Attackers have online db of exploits against every major plug-in, browser and OS
2004: less observable, more efficient distribution mechanisms investigated
  - **drive-by download**
    - server that's infected can result in a download going to a user and then infect a client as a result 
    - similar to what Nimba did
    - attackers would infect servers in a variety of ways:
      - they'd infect lots of legit website 
        - ex. NASDAQ, London Stock Exchange
    - when a user goes to the server or website, just by loading the page they get infected using a combo of browser and plug-in vulnerabilities
  - search engine and browser community have been very aggressive with trying to prevent this

## Zeus Botnet
- impacted financial community
- focused on stealing financial credentials
- would spread by drive-by-download and phishing in 2009; first identified in 2007
- part of the reason it affected so many machines was because of drive-by-downloading

## How a Drive-By-Download Attack Works

1. Inject legit web page with malicious code or direct user to already infected web page.
2. Once user is at the infected web page, it basically has JS/IFRAME code whose sole goal is to fingerprint user's browser and figure out version, and plugins. Attackers have online db of exploits against every major plug-in, browser and OS
2004: less observable, more efficient distribution mechanisms investigated
  - **drive-by download**
    - server that's infected can result in a download going to a user and then infect a client as a result 
    - similar to what Nimba did
    - attackers would infect servers in a variety of ways:
      - they'd infect lots of legit website 
        - ex. NASDAQ, London Stock Exchange
    - when a user goes to the server or website, just by loading the page they get infected using a combo of browser and plug-in vulnerabilities
  - search engine and browser community have been very aggressive with trying to prevent this

## Zeus Botnet
- impacted financial community
- focused on stealing financial credentials
- would spread by drive-by-download and phishing in 2009; first identified in 2007
- part of the reason it affected so many machines was because of drive-by-downloading

## How a Drive-By-Download Attack Works

1. Inject legit web page with malicious code or direct user to already infected web page.
2. Once user is at the infected web page, it basically has JS/IFRAME code whose sole goal is to fingerprint user's browser and figure out version, and plugins. Attackers have online db of exploits against every major plug-in, browser and OS
2004: less observable, more efficient distribution mechanisms investigated
  - **drive-by download**
    - server that's infected can result in a download going to a user and then infect a client as a result 
    - similar to what Nimba did
    - attackers would infect servers in a variety of ways:
      - they'd infect lots of legit website 
        - ex. NASDAQ, London Stock Exchange
    - when a user goes to the server or website, just by loading the page they get infected using a combo of browser and plug-in vulnerabilities
  - search engine and browser community have been very aggressive with trying to prevent this

## Zeus Botnet
- impacted financial community
- focused on stealing financial credentials
- would spread by drive-by-download and phishing in 2009; first identified in 2007
- part of the reason it affected so many machines was because of drive-by-downloading

## How a Drive-By-Download Attack Works

1. Inject legit web page with malicious code or direct user to already infected web page.
2. Once user is at the infected web page, it basically has JS/IFRAME code whose sole goal is to fingerprint user's browser and figure out version, and plugins. Attackers have online db of exploits against every major plug-in, browser and OS
2004: less observable, more efficient distribution mechanisms investigated
  - **drive-by download**
    - server that's infected can result in a download going to a user and then infect a client as a result 
    - similar to what Nimba did
    - attackers would infect servers in a variety of ways:
      - they'd infect lots of legit website 
        - ex. NASDAQ, London Stock Exchange
    - when a user goes to the server or website, just by loading the page they get infected using a combo of browser and plug-in vulnerabilities
  - search engine and browser community have been very aggressive with trying to prevent this

## Zeus Botnet
- impacted financial community
- focused on stealing financial credentials
- would spread by drive-by-download and phishing in 2009; first identified in 2007
- part of the reason it affected so many machines was because of drive-by-downloading

## How a Drive-By-Download Attack Works

1. Inject legit web page with malicious code or direct user to already infected web page.
2. Once user is at the infected web page, it basically has JS/IFRAME code whose sole goal is to fingerprint user's browser and figure out version, and plugins. Attackers have online db of exploits against every major plug-in, browser and OS
2004: less observable, more efficient distribution mechanisms investigated
  - **drive-by download**
    - server that's infected can result in a download going to a user and then infect a client as a result 
    - similar to what Nimba did
    - attackers would infect servers in a variety of ways:
      - they'd infect lots of legit website 
        - ex. NASDAQ, London Stock Exchange
    - when a user goes to the server or website, just by loading the page they get infected using a combo of browser and plug-in vulnerabilities
  - search engine and browser community have been very aggressive with trying to prevent this

## Zeus Botnet
- impacted financial community
- focused on stealing financial credentials
- would spread by drive-by-download and phishing in 2009; first identified in 2007
- part of the reason it affected so many machines was because of drive-by-downloading

## How a Drive-By-Download Attack Works

1. Inject legit web page with malicious code or direct user to already infected web page.
2. Once user is at the infected web page, it basically has JS/IFRAME code whose sole goal is to fingerprint user's browser and figure out version, and plugins. Attackers have online db of exploits against every major plug-in, browser and OS
2004: less observable, more efficient distribution mechanisms investigated
  - **drive-by download**
    - server that's infected can result in a download going to a user and then infect a client as a result 
    - similar to what Nimba did
    - attackers would infect servers in a variety of ways:
      - they'd infect lots of legit website 
        - ex. NASDAQ, London Stock Exchange
    - when a user goes to the server or website, just by loading the page they get infected using a combo of browser and plug-in vulnerabilities
  - search engine and browser community have been very aggressive with trying to prevent this

## Zeus Botnet
- impacted financial community
- focused on stealing financial credentials
- would spread by drive-by-download and phishing in 2009; first identified in 2007
- part of the reason it affected so many machines was because of drive-by-downloading

## How a Drive-By-Download Attack Works

1. Inject legit web page with malicious code or direct user to already infected web page.
2. Once user is at the infected web page, it basically has JS/IFRAME code whose sole goal is to fingerprint user's browser and figure out version, and plugins. Attackers have online db of exploits against every major plug-in, browser and OS
2004: less observable, more efficient distribution mechanisms investigated
  - **drive-by download**
    - server that's infected can result in a download going to a user and then infect a client as a result 
    - similar to what Nimba did
    - attackers would infect servers in a variety of ways:
      - they'd infect lots of legit website 
        - ex. NASDAQ, London Stock Exchange
    - when a user goes to the server or website, just by loading the page they get infected using a combo of browser and plug-in vulnerabilities
  - search engine and browser community have been very aggressive with trying to prevent this

## Zeus Botnet
- impacted financial community
- focused on stealing financial credentials
- would spread by drive-by-download and phishing in 2009; first identified in 2007
- part of the reason it affected so many machines was because of drive-by-downloading

## How a Drive-By-Download Attack Works

1. Inject legit web page with malicious code or direct user to already infected web page.
2. Once user is at the infected web page, it basically has JS/IFRAME code whose sole goal is to fingerprint user's browser and figure out version, and plugins. Attackers have online db of exploits against every major plug-in, browser and OS
2004: less observable, more efficient distribution mechanisms investigated
  - **drive-by download**
    - server that's infected can result in a download going to a user and then infect a client as a result 
    - similar to what Nimba did
    - attackers would infect servers in a variety of ways:
      - they'd infect lots of legit website 
        - ex. NASDAQ, London Stock Exchange
    - when a user goes to the server or website, just by loading the page they get infected using a combo of browser and plug-in vulnerabilities
  - search engine and browser community have been very aggressive with trying to prevent this

## Zeus Botnet
- impacted financial community
- focused on stealing financial credentials
- would spread by drive-by-download and phishing in 2009; first identified in 2007
- part of the reason it affected so many machines was because of drive-by-downloading

## How a Drive-By-Download Attack Works

1. Inject legit web page with malicious code or direct user to already infected web page.
2. Once user is at the infected web page, it basically has JS/IFRAME code whose sole goal is to fingerprint user's browser and figure out version, and plugins. Attackers have online db of exploits against every major plug-in, browser and OS
2004: less observable, more efficient distribution mechanisms investigated
  - **drive-by download**
    - server that's infected can result in a download going to a user and then infect a client as a result 
    - similar to what Nimba did
    - attackers would infect servers in a variety of ways:
      - they'd infect lots of legit website 
        - ex. NASDAQ, London Stock Exchange
    - when a user goes to the server or website, just by loading the page they get infected using a combo of browser and plug-in vulnerabilities
  - search engine and browser community have been very aggressive with trying to prevent this

## Zeus Botnet
- impacted financial community
- focused on stealing financial credentials
- would spread by drive-by-download and phishing in 2009; first identified in 2007
- part of the reason it affected so many machines was because of drive-by-downloading

## How a Drive-By-Download Attack Works

1. Inject legit web page with malicious code or direct user to already infected web page.
2. Once user is at the infected web page, it basically has JS/IFRAME code whose sole goal is to fingerprint user's browser and figure out version, and plugins. Attackers have online db of exploits against every major plug-in, browser and OS
2004: less observable, more efficient distribution mechanisms investigated
  - **drive-by download**
    - server that's infected can result in a download going to a user and then infect a client as a result 
    - similar to what Nimba did
    - attackers would infect servers in a variety of ways:
      - they'd infect lots of legit website 
        - ex. NASDAQ, London Stock Exchange
    - when a user goes to the server or website, just by loading the page they get infected using a combo of browser and plug-in vulnerabilities
  - search engine and browser community have been very aggressive with trying to prevent this

## Zeus Botnet
- impacted financial community
- focused on stealing financial credentials
- would spread by drive-by-download and phishing in 2009; first identified in 2007
- part of the reason it affected so many machines was because of drive-by-downloading

## How a Drive-By-Download Attack Works

1. Inject legit web page with malicious code or direct user to already infected web page.
2. Once user is at the infected web page, it basically has JS/IFRAME code whose sole goal is to fingerprint user's browser and figure out version, and plugins. Attackers have online db of exploits against every major plug-in, browser and OS. 
3. Online exploit kit is consulted and figures out what malicious code to send to client machine to take control of it.
4. Once attacker gets some new processes started, it can send a downloader (piece of malware whose sole goal is to download more malware) such that it can be added to a bot net or rented out to other attackers.
 
## How to Infect a Legit Website

- many components that come from different pages (ex. some widget that uses some 3rd party to measure traffic)
- if an attacker can figure out how to compromise any of these components then the malicious code will run when a user visits the site
- many websites where you can login to the webiste and change content via FTP
- compromised passwords
- software vulnerabilities
- infrastructure vulnerabilities

## Injecting JS
- if this runs in a browser, it's basically a blob that's unescaped
- if you unencode it and replace certain characters, you get a string that produces more code which produces _more_ code and produces small pieces of javascript
  - gets content from 2 IP addresses and runs it
- obfuscated JS is the beginning of an infection path

## Examples of Vulnerabilities 
- buffer overflows: one in Adobe Acrobat, and another in Acrobat Reader
- fingerprints PDF reader and then delivers appropriate shellcode

**Shellcode**: code used to take control of a running process

- in this example, takes advantage of JS interpreter in the browser and uses a buffer overflow called `Heap Spray`
- if you look at the TCP stream, it'll make a connection to a bot master and ask it what to do
 

 
